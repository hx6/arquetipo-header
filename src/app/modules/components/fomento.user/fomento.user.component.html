<div class="user-menu" *ngIf="!errores">
  <div class="user-trigger" [matMenuTriggerFor]="userMenu">
    <span class="user-initials">{{ usuario | slice:0:2 }}</span>
    <i class="ri-arrow-down-s-line"></i>
  </div>

  <mat-menu #userMenu="matMenu" xPosition="before">
    <div class="user-menu-content">
      <div class="user-header">
        <span class="user-name">{{ usuario }}</span>
        <span class="user-role" *ngIf="listaPrivilegios?.length">{{ listaPrivilegios[0] }}</span>
      </div>

      <div class="user-info" *ngIf="ultimoAcceso">
        <span class="last-access">{{ ultimoAcceso }}</span>
      </div>

      <div class="user-actions">
        <button mat-menu-item *ngIf="data?.length > 0 && data[2]" (click)="openDialog()">
          <i [class]="data[2].iconChangeRol"></i>
          <span>{{ data[2].labelBotonCambiaRol || 'Cambiar de rol' }}</span>
        </button>

        <button mat-menu-item *ngIf="data?.length > 0 && data[3]">
          <i [class]="data[3].iconLogOut"></i>
          <span>{{ data[3].labelBotonlogOut || 'Cerrar sesión' }}</span>
        </button>
      </div>
    </div>
  </mat-menu>
</div>

<ng-template #dialogTemplate>
  <div class="dialog-content">
    <div class="dialog-header">
      <h2>Cambio de privilegio</h2>
      <button mat-icon-button (click)="closeDialog()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <mat-divider></mat-divider>

    <div class="dialog-body">
      <p>Ha accedido a la aplicación con el privilegio <strong>{{ listaPrivilegios[0] }}</strong></p>
      
      <mat-form-field appearance="outline">
        <mat-label>Cambiar privilegio a:</mat-label>
        <mat-select [(value)]="selectedPrivilege">
          <mat-option *ngFor="let priv of listaPrivilegios" [value]="priv">
            {{ priv }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="dialog-actions">
      <button mat-button (click)="closeDialog()">Cancelar</button>
      <button mat-raised-button color="primary" [disabled]="!selectedPrivilege" (click)="changeRole()">
        Cambiar
      </button>
    </div>
  </div>
</ng-template>